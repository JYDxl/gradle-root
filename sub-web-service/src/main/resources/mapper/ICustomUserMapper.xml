<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.github.web.mapper.ICustomUserMapper">
  <resultMap id="queryUserInfo" type="org.github.base.model.dto.UserInfoDTO">
    <id column="user_id" property="id"/>
    <result column="username" property="username"/>
    <result column="password" property="password"/>
    <result column="create_time" property="createTime"/>
    <result column="salt" property="salt"/>

    <collection property="roleList" ofType="org.github.base.model.dto.RoleInfoDTO">
      <id column="role_id" property="id"/>
      <result column="role_name" property="name"/>
      <result column="description" property="description"/>

      <collection property="permissionList" ofType="org.github.base.entity.PermissionEntity">
        <id column="permission_id" property="id"/>
        <result column="permission_name" property="name"/>
        <result column="url" property="url"/>
      </collection>
    </collection>
  </resultMap>

  <select id="queryUserInfo" resultMap="queryUserInfo">
    select
      u.id          as user_id,
      u.username    as username,
      u.password    as password,
      u.create_time as create_time,
      u.salt        as salt,
      r.id          as role_id,
      r.name        as role_name,
      r.description as description,
      p.id          as permission_id,
      p.name        as permission_name,
      p.url         as url
    from user u
           left join user_role ur on u.id = ur.user_id
           left join role r on ur.role_id = r.id
           left join role_permission rp on r.id = rp.role_id
           left join permission p on rp.permission_id = p.id
    where username = #{username}
  </select>
</mapper>
